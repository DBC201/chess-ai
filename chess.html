<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="./public/chessboard2.min.css">
	<script src="./public/chessboard2.min.js"></script>

	<script src="./public/chess.min.js"></script>

	<script src="./public/ai.js"></script>

	<style>
		.button_class {
			width: 75px;
			height: 30px;
			margin: 15px;
		}
	</style>
</head>

<body style="text-align: center;">

	<div id="myBoard" style="width: 600px; margin: 0 auto; margin-top: 75px;"></div>
	<br>
	<br>
	<button class="button_class" id="start" onclick="start()">start</button>
	<button class="button_class" id="stop" onclick="stop()">stop</button>
	<button class="button_class" id="reset" onclick="reset()">reset</button>
	<br>
	<br>
	<button class="button_class" id="undo" onclick="undo()">Undo</button>
	<br>
	<br>
	<label for="speed">Speed:</label>
	<input type="number" id="speed" value="500" style="width: 75px; height: 30px; margin: 15px;">
	<br>
	<br>
	<label for="white_depth">White depth:</label>
	<input type="number" id="white_depth" value="2" style="width: 75px; height: 30px; margin: 15px;">
	<br>
	<br>
	<label for="black_depth">Black depth:</label>
	<input type="number" id="black_depth" value="2" style="width: 75px; height: 30px; margin: 15px;">
	<br>
	<br>
	<label for="debug">Debug mode(stop after one move and print debug info to console):</label> <br><input
		type="checkbox" id="debug">
	<br>
	<br>
	<label for="fen">Enter fen and press reset(blank for start):</label>
	<br>
	<br>
	<textarea id="fen" style="width: 400px; height: 100px"></textarea>
	<br>
	<br>
	<p id="pgn"></p>
	<script>

		const game = new Chess();
		const board = Chessboard2('myBoard', {
			draggable: false,
			position: 'start',
			// onDragStart,
			// onDrop,
			// onMouseoutSquare,
			// onMouseoverSquare,
			// onSnapEnd
		});

		function onDrop({ source, target, piece, orientation }) {
			console.log('Source: ' + source)
			console.log('Target: ' + target)
			console.log('Piece: ' + piece);
			game.move({ from: source, to: target });
			console.log(game.moves({ verbose: true }));
		}

		let stop_flag = false;
		let in_progress = false;

		function play() {
			if (stop_flag) {
				document.getElementById('pgn').innerText = game.pgn();
				document.getElementById("start").disabled = false;
				document.getElementById("undo").disabled = false;
				return;
			}

			if (game.game_over()) {
				stop_flag = true;
				document.getElementById('pgn').innerText = game.pgn();
				document.getElementById("start").disabled = false;
				document.getElementById("undo").disabled = false;
				return;
			}

			let nextMove;
			let start;

			if (document.getElementById('debug').checked) {
				start = performance.now();
			}

			if (game.turn() == 'b') {
				nextMove = getBestMove(game, document.getElementById('black_depth').value, document.getElementById('debug').checked);
			} else {
				nextMove = getBestMove(game, document.getElementById('white_depth').value, document.getElementById('debug').checked);
			}

			if (document.getElementById('debug').checked) {
				console.log('Time taken: ', performance.now() - start);
				stop_flag = true;
			}

			game.move(nextMove);
			board.position(game.fen());
			setTimeout(play, document.getElementById('speed').value);
		}

		function start() {
			stop_flag = false;
			document.getElementById("start").disabled = true;
			document.getElementById("undo").disabled = true;
			play();
		}

		function stop() {
			document.getElementById('pgn').innerText = game.pgn();
			document.getElementById("start").disabled = false;
			document.getElementById("undo").disabled = false;
			stop_flag = true;
		}

		function undo() {
			game.undo();
			board.position(game.fen());
		}

		function reset() {
			game.reset();
			const fen = document.getElementById('fen').value;
			if (fen) {
				game.load(fen);
			}
			board.position(game.fen());
		}
	</script>

</body>

</html>